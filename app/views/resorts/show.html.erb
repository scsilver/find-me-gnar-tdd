<div id="<%= @resort.location %>", class="stats">
<%= @resort.name %>
<%= @resort.symbol %>
<%= @resort.site %>
<%= @resort.temp %>
<%= @resort.base %>
<%= @resort.snowfall_24hr %>
<%= @resort.rating %>
<%= @resort.webcam %>
</div>


<div class="resort_tweets">
<% @tweets.each do |tweet| %>
  <%= tweet.content %>
<% end %>
</div>

<<form id="tagsearch">
  <p>
    <label for="tag">Hashtag:</label>
    <input type="text" id="tag" name="tag" placeholder="<%=@resort.location%>" required pattern="[a-zA-Z0-9]+" />
    <input type="submit" value="Search" />
  </p>
</form>



<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Displaying text directions with <code>setPanel()</code></title>
    <style>
    body {
    font: 75% "Helvetica Neue", sans-serif;
    color: #333;
    }
    input {
        font-size: 100%;
    }
    input[type="text"] {
        border: 1px solid #ccc;
        padding: 4px 8px;
    }
    img {
        display: block;
        float: left;
    }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
      }
#floating-panel {
  position: absolute;
  top: 10px;
  left: 25%;
  z-index: 5;
  background-color: #fff;
  padding: 5px;
  border: 1px solid #999;
  text-align: center;
  font-family: 'Roboto','sans-serif';
  line-height: 30px;
  padding-left: 10px;
}

#right-panel {
  font-family: 'Roboto','sans-serif';
  line-height: 30px;
  padding-left: 10px;
}

#right-panel select, #right-panel input {
  font-size: 15px;
}

#right-panel select {
  width: 100%;
}

#right-panel i {
  font-size: 12px;
}

      #right-panel {
        height: 100%;
        float: right;
        width: 390px;
        overflow: auto;
      }

      #map {
        margin-right: 400px;
      }

      #floating-panel {
        background: #fff;
        padding: 5px;
        font-size: 14px;
        font-family: Arial;
        border: 1px solid #ccc;
        box-shadow: 0 2px 2px rgba(33, 33, 33, 0.4);
        display: none;
      }

      @media print {
        #map {
          height: 500px;
          margin: 0;
        }

        #right-panel {
          float: none;
          width: auto;
        }
      }
    </style>
  </head>
  <body>
    <div id="floating-panel"></div>
    <div id="right-panel"></div>
    <div id="map"></div>

    <script>
    var access_token = "16384709.6ac06b4.49b97800d7fd4ac799a2c889f50f2587",
        access_parameters = {
            access_token: access_token
        };

    var form = $('#tagsearch');
    form.on('submit', function(ev) {
        var q = this.tag.value;
        if(q.length) {
            //console.log(q);
            grabImages(q, 40, access_parameters);
        }
        ev.preventDefault();
    });

    function grabImages(tag, count, access_parameters) {
          var loc = '<%=@resort.location%>'
          var lat = loc.split(',')[0];
          var log = loc.split(',')[1];
          var latlog = 'lat='+lat+"&lng="+log;
        var instagramUrl = 'https://api.instagram.com/v1/media/search?'+ latlog +'&distance=10000&callback=?&count=' + count;
        $.getJSON(instagramUrl, access_parameters, onDataLoaded);

    }

    function onDataLoaded(instagram_data) {
        var instagram = $("#instagram");
        if (instagram_data.meta.code == 200) {
            var photos = instagram_data.data;
            if (photos.length > 0) {
                instagram.empty();
                for (var key in photos) {
                    var photo = photos[key];
                    instagram.append('<a href="' + photo.link + '"><img src="' + photo.images.thumbnail.url + '"></a>')
                }
            } else {
                instagram.html("nothing found");
            }
        } else {
            var error = instagram_data.meta.error_message;
            instagram.html(error);
        }
    }

    grabImages('unicorn', 40, access_parameters);
    </script>

    <script>

function initMap() {
  var directionsDisplay = new google.maps.DirectionsRenderer;
  var directionsService = new google.maps.DirectionsService;
  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 7,
    center: {lat: 41.85, lng: -87.65}
  });
  directionsDisplay.setMap(map);
  directionsDisplay.setPanel(document.getElementById('right-panel'));

  //var control = document.getElementById('floating-panel');
  //control.style.display = 'block';
  //map.controls[google.maps.ControlPosition.TOP_CENTER].push(control);
  window.onload = calculateAndDisplayRoute(directionsService, directionsDisplay);

  var onChangeHandler = function() {
    calculateAndDisplayRoute(directionsService, directionsDisplay);
  };

}

function calculateAndDisplayRoute(directionsService, directionsDisplay) {
  var start_point;
  var end_point;
  directionsService.route({
    origin: '<%=@direction.from%>',
    destination: '<%=@resort.location%>',
    travelMode: google.maps.TravelMode.DRIVING
  }, function(response, status) {
    if (status === google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
      debugger;
    } else {
      window.alert('Directions request failed due to ' + status);
    }
  });

}
//$.ajax({
//  type: "GET",
//  url: "https://api.instagram.com/v1/media/search?lat=48.858844&lng=2.294351&access_token=e868ca13f4a846e99c07f3a79d4ef8c4",
//  dataType: "json",
//  async: false,
//  success: function(data) {
//    start_point = data.location;
//  }
//});

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBb3ZSbRxq6PQSsJmpTT9bR79HghrI9_LE&signed_in=true&callback=initMap"
        async defer></script>
  </body>
</html>
